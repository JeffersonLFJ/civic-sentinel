<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentinela C√≠vico - Admin</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h2>ü¶Ö Sentinela</h2>
                <span>Painel de Controle</span>
            </div>
            <nav>
                <a href="#" id="docsNav" class="active" onclick="showSection('docs')">üìÑ Documentos</a>
                <a href="#" id="auditNav" onclick="showSection('audit')">üìä Auditoria & Raio-X</a>
                <a href="#" onclick="openLogs()">üìú Logs do Sistema</a>
                <a href="inspector.html">üîç Inspetor de Dados</a>
                <a href="chat.html" target="_blank">üí¨ Chat de Teste ‚Üó</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Prompt Editor Modal -->
            <div id="promptModal" class="modal hidden">
                <div class="modal-content"
                    style="width: 80%; max-width: 800px; height: 80vh; display: flex; flex-direction: column;">
                    <h3>‚öôÔ∏è Editor de Prompt do Sistema</h3>
                    <p style="color:#94a3b8; font-size:0.9rem; margin-bottom:1rem;">
                        Defina as instru√ß√µes de comportamento, bio√©tica e formata√ß√£o da IA do Sentinela.
                    </p>
                    <textarea id="systemPromptInput"
                        style="flex:1; background:#0f172a; border:1px solid #334155; color:#e2e8f0; padding:15px; border-radius:6px; font-family:monospace; line-height:1.5; resize:none;"></textarea>

                    <div class="modal-actions" style="margin-top:1rem;">
                        <button onclick="closePromptModal()" class="btn secondary">Cancelar</button>
                        <button onclick="saveSystemPrompt()" class="btn primary">Salvar Altera√ß√µes</button>
                    </div>
                </div>
            </div>

            <!-- SE√á√ÉO: DOCUMENTOS -->
            <section id="docsSection">
                <header>
                    <h1>Gest√£o de Documentos</h1>
                    <div class="actions">
                        <button id="promptBtn" class="btn secondary"
                            style="background: #0f172a; color: #a5b4fc; border: 1px solid #334155;">‚öôÔ∏è Prompt</button>
                        <button id="refreshBtn" class="btn secondary">üîÑ Atualizar</button>
                        <button id="scanLocalBtn" class="btn secondary"
                            style="background: #0f172a; color: #fff; border: 1px solid #334155;">üìÅ Scan Pasta
                            Local</button>
                        <button id="uploadBtn" class="btn primary">+ Upload Manual</button>
                    </div>
                </header>

                <div class="stats-cards">
                    <div class="card">
                        <h3>Total Indexado</h3>
                        <p id="totalDocs">...</p>
                    </div>
                    <div class="card">
                        <h3>√öltima Ingest√£o</h3>
                        <p>Hoje</p>
                    </div>
                    <div class="card warning">
                        <h3>Alertas de Risco</h3>
                        <p>0 (Demo)</p>
                    </div>
                </div>

                <div class="documents-list">
                    <table>
                        <thead>
                            <tr>
                                <th>Arquivo</th>
                                <th>Fonte</th>
                                <th>Tipo</th>
                                <th>Data Publica√ß√£o</th>
                                <th>Status (OCR)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="docsTableBody">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- SE√á√ÉO: AUDITORIA (P√ÅGINA INTEIRA) -->
            <section id="auditSection" class="hidden">
                <header>
                    <h1>Auditoria & Raio-X</h1>
                    <div class="actions">
                        <button onclick="clearAuditLogs()" class="btn danger-sm">üóëÔ∏è Limpar Auditoria</button>
                        <button onclick="fetchAuditoria()" class="btn secondary">üîÑ Atualizar</button>
                    </div>
                </header>

                <div class="audit-grid"
                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: calc(100vh - 150px);">
                    <!-- Coluna Esq: Lista de Intera√ß√µes -->
                    <div class="card" style="display: flex; flex-direction: column; overflow: hidden;">
                        <h4 style="margin-bottom: 15px; color: #94a3b8;">Hist√≥rico de Intera√ß√µes</h4>
                        <div style="flex: 1; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #1e293b; color: #94a3b8; text-align: left;">
                                        <th style="padding: 10px;">Data/Hora</th>
                                        <th style="padding: 10px;">Pergunta</th>
                                        <th style="padding: 10px;">Confian√ßa</th>
                                    </tr>
                                </thead>
                                <tbody id="auditTableBody">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Coluna Dir: O Inspetor (Raio-X) -->
                    <div id="inspectorPanel" class="card"
                        style="display: flex; flex-direction: column; overflow: hidden; border-color: #3b82f6;">
                        <h4 style="margin-bottom: 15px; color: #3b82f6;">üîç Inspetor Raio-X</h4>
                        <div id="inspectorContent" style="flex: 1; overflow-y: auto;">
                            <div style="text-align: center; color: #94a3b8; padding: 40px;">
                                <p>Selecione uma intera√ß√£o √† esquerda para ver o Raio-X t√©cnico.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Upload Modal -->
        <div id="uploadModal" class="modal hidden">
            <div class="modal-content">
                <h3>Upload de Documento</h3>

                <label class="block text-sm font-medium mb-1 text-gray-300"
                    style="text-align: left; display: block; margin-bottom: 5px;">Tipo de Documento</label>
                <select id="docType"
                    style="width: 100%; background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 6px; margin-bottom: 15px; outline: none;">
                    <option value="lei">Lei / Legisla√ß√£o (HTML)</option>
                    <option value="denuncia">Documentos (Imagens e PDF)</option>
                    <option value="diario">Di√°rio Oficial</option>
                    <option value="tabela">Planilhas / Tabelas (Excel e CSV)</option>
                </select>

                <div class="file-drop-area">
                    <span class="file-msg">Arraste ou clique aqui</span>
                    <input class="file-input" type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg,.txt,.html"
                        required>
                </div>
                <div class="modal-actions">
                    <button id="cancelUpload" class="btn secondary">Cancelar</button>
                    <button id="confirmUpload" class="btn primary">Enviar</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="modal hidden" style="z-index: 2000;">
        <div class="modal-content" style="text-align: center;">
            <div class="spinner"></div>
            <h3 id="loadingText" style="margin-top: 1rem;">Processando...</h3>
            <p id="loadingSubtext" style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem;">Isso pode levar alguns
                segundos.</p>

            <!-- Progress Bar -->
            <div id="progressContainer"
                style="width: 100%; height: 8px; background: #334155; border-radius: 4px; margin-top: 20px; overflow: hidden;">
                <div id="progressBar"
                    style="width: 0%; height: 100%; background: #3b82f6; transition: width 0.3s ease;"></div>
            </div>

            <!-- Live Logs View -->
            <div id="uploadLogViewer"
                style="margin-top: 15px; width: 100%; height: 150px; background: #1e293b; border-radius: 6px; padding: 10px; font-family: monospace; font-size: 0.8rem; color: #94a3b8; overflow-y: auto; text-align: left; border: 1px solid #334155;">
                <div
                    style="margin-bottom: 5px; border-bottom: 1px solid #334155; padding-bottom: 5px; display: flex; justify-content: space-between;">
                    <span>üìú Logs em Tempo Real:</span>
                    <span id="progressText" style="color: #3b82f6; font-weight: bold;">0%</span>
                </div>
                <div id="miniLogContent">Aguardando in√≠cio...</div>
            </div>

            <!-- New Close Button -->
            <button id="closeLoadingBtn" class="btn primary"
                style="margin-top: 20px; display: none; width: 100%;">Fechar e Atualizar</button>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal hidden">
        <div class="modal-content">
            <h3>Confirmar Exclus√£o</h3>
            <p>Tem certeza que deseja excluir este documento? Esta a√ß√£o n√£o pode ser desfeita.</p>
            <div class="modal-actions">
                <button id="cancelDelete" class="btn secondary">Cancelar</button>
                <button id="confirmDelete" class="btn danger">Excluir</button>
            </div>
        </div>
    </div>


    <div id="logsModal" class="modal hidden">
        <div class="modal-content"
            style="width: 85%; max-width: 1000px; height: 85vh; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>üìú Logs do Sistema</h3>
                <button class="btn secondary" onclick="closeLogs()">Fechar</button>
            </div>
            <div id="logsContainer"
                style="flex: 1; background: #0f172a; padding: 1rem; overflow-y: auto; font-family: monospace; color: #a5b4fc; font-size: 0.85rem; border-radius: 6px; border: 1px solid #334155;">
                <!-- Filled by JS -->
            </div>
        </div>
    </div>

    <!-- Scan Local Modal -->
    <div id="scanModal" class="modal hidden">
        <div class="modal-content"
            style="width: 90%; max-width: 900px; max-height: 85vh; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>üìÅ Scan de Pasta Local (data/ingest)</h3>
                <button class="btn secondary" onclick="closeScanModal()">Fechar</button>
            </div>

            <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 1rem;">
                Os arquivos abaixo foram encontrados na pasta local. Escolha o tipo de cada um e clique em "Iniciar
                Ingest√£o".
            </p>

            <div
                style="margin-bottom: 1rem; display: flex; gap: 10px; align-items: center; background: #0f172a; padding: 10px; border-radius: 6px;">
                <span style="font-size: 0.85rem; color: #94a3b8;">Definir em bloco:</span>
                <select id="bulkDocType"
                    style="background: #1e293b; border: 1px solid #334155; color: white; padding: 5px; border-radius: 4px; font-size: 0.85rem;">
                    <option value="">-- Selecione --</option>
                    <option value="lei">Lei / Legisla√ß√£o (HTML)</option>
                    <option value="denuncia">Documentos (Imagens e PDF)</option>
                    <option value="tabela">Planilhas / Tabelas</option>
                    <option value="diario">Di√°rio Oficial</option>
                </select>
                <button class="btn secondary" style="padding: 5px 10px; font-size: 0.85rem;"
                    onclick="applyBulkType()">Aplicar Selecionados</button>
            </div>

            <div style="flex: 1; overflow-y: auto;">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                    <thead>
                        <tr style="background: #1e293b; color: #94a3b8; text-align: left;">
                            <th style="padding: 10px;"><input type="checkbox" id="selectAllScan"
                                    onclick="toggleAllScan(this)"></th>
                            <th style="padding: 10px;">Arquivo</th>
                            <th style="padding: 10px;">Tamanho</th>
                            <th style="padding: 10px;">Tipo de Ingest√£o</th>
                        </tr>
                    </thead>
                    <tbody id="scanTableBody">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>

            <div class="modal-actions" style="margin-top: 1rem; border-top: 1px solid #334155; padding-top: 1rem;">
                <button onclick="closeScanModal()" class="btn secondary">Cancelar</button>
                <button onclick="processSelectedScan()" class="btn primary" id="startIngestBtn">Iniciar
                    Ingest√£o</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=4"></script>
</body>

</html>